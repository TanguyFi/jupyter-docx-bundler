steps:
  - script: conda create --yes --quiet --name jupyter-docx-bundler-testing --file requirements.txt --file requirements_test.txt python=$(python.version)
    displayName: Create conda environment for testing
  - script: |
      source activate jupyter-docx-bundler-testing
      pytest . --junitxml=result.xml
    condition: or(eq( variables['Agent.OS'], 'Linux' ), eq( variables['Agent.OS'], 'Darwin' ))
    displayName: pytest on unix
  - script: |
      call activate jupyter-docx-bundler-testing
      pytest . --junitxml=result.xml
    condition: eq( variables['Agent.OS'], 'Windows_NT' )
    displayName: pytest on windows
  - task: PublishTestResults@2
    inputs:
      testResultsFiles: 'result.xml'
      testRunTitle: 'Python $(python.version)'
